{"version":3,"file":"transform-sources.transform.js","sourceRoot":"","sources":["../../../../../src/lib/ng-v5/entry-point/ts/transform-sources.transform.ts"],"names":[],"mappings":";;AAAA,8CAAqC;AACrC,yCAAsC;AAGtC,yCAAyC;AACzC,gFAA2E;AAC3E,mFAAqF;AACrF,6DAAoE;AAEvD,QAAA,yBAAyB,GAAc,WAAI,CACtD,eAAG,CAAC,KAAK,CAAC,EAAE;IACV,MAAM,UAAU,GAAG,KAAK,CAAC,IAAI,CAAC,+BAAY,EAAE,CAAC,GAAG,CAAC,+BAAY,CAAC,CAAC,CAAC;IAChE,GAAG,CAAC,KAAK,CAAC,uCAAuC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC,CAAC;IAExF,mDAAmD;IACnD,MAAM,eAAe,GAAG,wDAA6B,CAAC;QACpD,QAAQ,EAAE,CAAC,EAAE,gBAAgB,EAAE,EAAE,EAAE;YACjC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,KAAK,UAAU,gBAAgB,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;QACpF,CAAC;QACD,UAAU,EAAE,CAAC,EAAE,aAAa,EAAE,EAAE,EAAE;YAChC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,KAAK,UAAU,aAAa,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;QACjF,CAAC;KACF,CAAC,CAAC;IAEH,oBAAoB;IACpB,MAAM,iBAAiB,GAAG,UAAU,CAAC,IAAI,CAAC,SAAmD,CAAC;IAE9F,qCAAqC;IACrC,UAAU,CAAC,IAAI,CAAC,SAAS,GAAG,6CAAoB,CAAC,iBAAiB,EAAE,CAAC,eAAe,CAAC,CAAC,CAAC;IAEvF,6CAA6C;IAC7C,iBAAiB,CAAC,OAAO,EAAE,CAAC;IAE5B,MAAM,CAAC,KAAK,CAAC;AACf,CAAC,CAAC,CACH,CAAC","sourcesContent":["import { map } from 'rxjs/operators';\nimport { pipe } from 'rxjs/util/pipe';\nimport * as ts from 'typescript';\nimport { Transform } from '../../../brocc/transform';\nimport * as log from '../../../util/log';\nimport { transformSourceFiles } from '../../../ngc/transform-source-files';\nimport { transformComponentSourceFiles } from '../../../ts/ng-component-transformer';\nimport { byEntryPoint, isInProgress } from '../../entry-point.node';\n\nexport const transformSourcesTransform: Transform = pipe(\n  map(graph => {\n    const entryPoint = graph.find(byEntryPoint().and(isInProgress));\n    log.debug(`Transforming TypeScript sources for ${entryPoint.data.entryPoint.moduleId}`);\n\n    // Transformer that inlines template and style data\n    const inlineResources = transformComponentSourceFiles({\n      template: ({ templateFilePath }) => {\n        return graph.find(node => node.url === `file://${templateFilePath}`).data.content;\n      },\n      stylesheet: ({ styleFilePath }) => {\n        return graph.find(node => node.url === `file://${styleFilePath}`).data.content;\n      }\n    });\n\n    // XX: TsSourcesNode\n    const previousTransform = entryPoint.data.tsSources as ts.TransformationResult<ts.SourceFile>;\n\n    // Modify the TypeScript source files\n    entryPoint.data.tsSources = transformSourceFiles(previousTransform, [inlineResources]);\n\n    // Dispose the previous transformation result\n    previousTransform.dispose();\n\n    return graph;\n  })\n);\n"]}