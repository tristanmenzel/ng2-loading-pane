"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const operators_1 = require("rxjs/operators");
const pipe_1 = require("rxjs/util/pipe");
const log = require("../../../util/log");
const transform_source_files_1 = require("../../../ngc/transform-source-files");
const ng_component_transformer_1 = require("../../../ts/ng-component-transformer");
const entry_point_node_1 = require("../../entry-point.node");
exports.transformSourcesTransform = pipe_1.pipe(operators_1.map(graph => {
    const entryPoint = graph.find(entry_point_node_1.byEntryPoint().and(entry_point_node_1.isInProgress));
    log.debug(`Transforming TypeScript sources for ${entryPoint.data.entryPoint.moduleId}`);
    // Transformer that inlines template and style data
    const inlineResources = ng_component_transformer_1.transformComponentSourceFiles({
        template: ({ templateFilePath }) => {
            return graph.find(node => node.url === `file://${templateFilePath}`).data.content;
        },
        stylesheet: ({ styleFilePath }) => {
            return graph.find(node => node.url === `file://${styleFilePath}`).data.content;
        }
    });
    // XX: TsSourcesNode
    const previousTransform = entryPoint.data.tsSources;
    // Modify the TypeScript source files
    entryPoint.data.tsSources = transform_source_files_1.transformSourceFiles(previousTransform, [inlineResources]);
    // Dispose the previous transformation result
    previousTransform.dispose();
    return graph;
}));
//# sourceMappingURL=transform-sources.transform.js.map