{"version":3,"file":"json.js","sourceRoot":"","sources":["../../../src/lib/util/json.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,6BAA6B;AAC7B,uCAA+C;AAC/C,2CAAwC;AACxC,+BAA8B;AAE9B;;;;;;GAMG;AACH,yBAAsC,WAAmB,EAAE,QAA+B;;QACxF,WAAK,CAAC,iBAAiB,CAAC,CAAC;QACzB,MAAM,SAAS,GAAa,MAAM,qBAAS,CAAW,eAAe,CAAC,EAAE;YACtE,IAAI,CAAC,WAAW,EAAE,eAAe,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QAEH,MAAM,OAAO,CAAC,GAAG,CACf,SAAS,CAAC,GAAG,CAAC,CAAO,QAAgB,EAAiB,EAAE;YACtD,MAAM,WAAW,GAAQ,MAAM,WAAW,CAAC,QAAQ,CAAC,CAAC;YACrD,MAAM,QAAQ,GAAG,QAAQ,CAAC,WAAW,CAAC,CAAC;YACvC,MAAM,oBAAS,CAAC,QAAQ,EAAE,QAAQ,EAAE,EAAE,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC;QACrD,CAAC,CAAA,CAAC,CACH,CAAC;IACJ,CAAC;CAAA;AAbD,0CAaC;AAED;;;;GAIG;AACH,qBAAkC,QAAgB;;QAChD,IAAI,CAAC;YACH,MAAM,CAAC,mBAAQ,CAAC,QAAQ,CAAC,CAAC;QAC5B,CAAC;QAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACX,2DAA2D;YAC3D,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAC7B,CAAC;IACH,CAAC;CAAA;AAPD,kCAOC","sourcesContent":["import * as glob from 'glob';\nimport { readJson, writeJson } from 'fs-extra';\nimport { promisify } from './promisify';\nimport { debug } from './log';\n\n/**\n * Modifies a set of JSON files by invoking `modifyFn`\n *\n * @param globPattern A glob pattern matching several files. Example: '**\\/*.js.map'\n * @param modifyFn A callback function that takes a JSON-parsed input and should return an output\n *                  that will be JSON-stringified\n */\nexport async function modifyJsonFiles(globPattern: string, modifyFn: (jsonObj: any) => any): Promise<void> {\n  debug('modifyJsonFiles');\n  const fileNames: string[] = await promisify<string[]>(resolveOrReject => {\n    glob(globPattern, resolveOrReject);\n  });\n\n  await Promise.all(\n    fileNames.map(async (fileName: string): Promise<void> => {\n      const fileContent: any = await tryReadJson(fileName);\n      const modified = modifyFn(fileContent);\n      await writeJson(fileName, modified, { spaces: 2 });\n    })\n  );\n}\n\n/**\n * Read json and don't throw if json parsing fails.\n *\n * @param filePath Path to the file which is parsed.\n */\nexport async function tryReadJson(filePath: string): Promise<any> {\n  try {\n    return readJson(filePath);\n  } catch (e) {\n    // this means the file was empty or not json, which is fine\n    return Promise.resolve({});\n  }\n}\n"]}